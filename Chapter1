--// UPDATED TO V2         [ V3 SOON ]
                           [ BUG REPORT ] - @drakedabest on discord
[ FIXED BUGS ]
- Not Executing
- Not Working Auto Collect
- Not working Tp Safe
- Not Working ESP Rat

-- Load libraries
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- Create window
local Window = Fluent:CreateWindow({
    Title = "Cheese Escape | NebulaStrike",
    SubTitle = "Fluent v" .. Fluent.Version,
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- Tabs
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "mouse-pointer" }),
    Utility = Window:AddTab({ Title = "Utility", Icon = "tool" }),
    Save = Window:AddTab({ Title = "Save", Icon = "save" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

-- ========== ESP: Rats ==========
Tabs.Main:AddButton({
    Title = "ESP Rats",
    Description = "Highlights all rat NPCs",
    Callback = function()
        for _, rat in pairs(workspace:GetDescendants()) do
            if rat:IsA("Model") and rat:FindFirstChild("HumanoidRootPart") and string.find(rat.Name:lower(), "rat") then
                if not rat:FindFirstChild("ESPHighlight") then
                    local highlight = Instance.new("Highlight")
                    highlight.Name = "ESPHighlight"
                    highlight.FillColor = Color3.fromRGB(255, 0, 0)
                    highlight.OutlineColor = Color3.new(0, 0, 0)
                    highlight.FillTransparency = 0.2
                    highlight.OutlineTransparency = 0
                    highlight.Adornee = rat
                    highlight.Parent = rat
                end
            end
        end
    end
})

-- ========== ESP: Cheese ==========
Tabs.Main:AddButton({
    Title = "ESP Cheese",
    Description = "Highlights all cheese items",
    Callback = function()
        for _, cheese in pairs(workspace:GetDescendants()) do
            if cheese:IsA("BasePart") and string.find(cheese.Name:lower(), "cheese") then
                if not cheese:FindFirstChild("ESPHighlight") then
                    local highlight = Instance.new("Highlight")
                    highlight.Name = "ESPHighlight"
                    highlight.FillColor = Color3.fromRGB(255, 255, 0)
                    highlight.OutlineColor = Color3.new(0, 0, 0)
                    highlight.FillTransparency = 0.2
                    highlight.OutlineTransparency = 0
                    highlight.Adornee = cheese
                    highlight.Parent = cheese
                end
            end
        end
    end
})

-- ========== Teleport to Cheese ==========
Tabs.Utility:AddButton({
    Title = "Teleport to Nearest Cheese",
    Description = "Instantly go to the closest cheese",
    Callback = function()
        local char = game.Players.LocalPlayer.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") then return end

        local closest, distance = nil, math.huge
        for _, cheese in pairs(workspace:GetDescendants()) do
            if cheese:IsA("BasePart") and string.find(cheese.Name:lower(), "cheese") then
                local dist = (char.HumanoidRootPart.Position - cheese.Position).Magnitude
                if dist < distance then
                    closest = cheese
                    distance = dist
                end
            end
        end

        if closest then
            char:PivotTo(CFrame.new(closest.Position + Vector3.new(0, 5, 0)))
        end
    end
})

-- ========== Auto Collect ==========
local AutoCollectToggle = Tabs.Utility:AddToggle("AutoCollectCheese", {
    Title = "Auto Collect Cheese",
    Description = "Automatically picks up nearby cheese",
    Default = false
})

AutoCollectToggle:OnChanged(function(Value)
    if Value then
        getgenv().AutoCollectCheese = true
        task.spawn(function()
            while getgenv().AutoCollectCheese do
                local char = game.Players.LocalPlayer.Character
                if not char or not char:FindFirstChild("HumanoidRootPart") then return end
                for _, cheese in pairs(workspace:GetDescendants()) do
                    if cheese:IsA("BasePart") and string.find(cheese.Name:lower(), "cheese") then
                        if (char.HumanoidRootPart.Position - cheese.Position).Magnitude < 10 then
                            char:PivotTo(CFrame.new(cheese.Position + Vector3.new(0, 5, 0)))
                            wait(0.2)
                        end
                    end
                end
                task.wait(1)
            end
        end)
    else
        getgenv().AutoCollectCheese = false
    end
end)

-- ========== Speed Slider ==========
Tabs.Utility:AddSlider("SpeedSlider", {
    Title = "Walk Speed",
    Description = "Set your movement speed",
    Default = 16,
    Min = 10,
    Max = 100,
    Rounding = 0,
    Callback = function(Value)
        local char = game.Players.LocalPlayer.Character
        if char and char:FindFirstChildOfClass("Humanoid") then
            char:FindFirstChildOfClass("Humanoid").WalkSpeed = Value
        end
    end
})

-- ========== Nickname Input ==========
Tabs.Settings:AddInput("Nickname", {
    Title = "Set Nickname",
    Default = "CheeseRunner",
    Placeholder = "Enter name",
    Callback = function(Value)
        print("Nickname set to:", Value)
    end
})

-- ========== Save Manager Setup ==========
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder("CheeseEscapeESP")
SaveManager:SetFolder("CheeseEscapeESP/GameConfigs")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Save)

Window:SelectTab(1)

Fluent:Notify({
    Title = "Cheese Escape Loaded",
    Content = "Exploit tools are ready!",
    Duration = 6
})

SaveManager:LoadAutoloadConfig()
