--// Load Luna GUI
local Luna = loadstring(game:HttpGet("https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/main/source.lua"))()

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")

local ESP_Enabled = false
local RatESP_Enabled = false
local Noclip = false
local Flying = false

--// GUI Setup
local Window = Luna:CreateWindow({
    Name = "Cheese Escape Hub",
    Subtitle = "By Frenzy | Luna Suite",
    LoadingTitle = "Cheese ESP Init",
    LoadingSubtitle = "Loading modules...",
    ConfigSettings = { ConfigFolder = "CheeseEscapeHub" },
    KeySystem = false
})

local Main = Window:CreateTab("Main")
local Player = Window:CreateTab("Player")
local Teleports = Window:CreateTab("Teleports")
local Visuals = Window:CreateTab("Visuals")
local Settings = Window:CreateTab("Settings")

--// ESP Functions
local function highlight(part, color)
    local h = Instance.new("Highlight", part)
    h.FillColor = color
    h.FillTransparency = 0.5
    h.OutlineColor = Color3.new(1, 1, 1)
end

local function toggleCheeseESP(state)
    ESP_Enabled = state
    for _, cheese in pairs(Workspace:GetDescendants()) do
        if cheese.Name:lower():find("cheese") and cheese:IsA("BasePart") then
            if state then
                highlight(cheese, Color3.fromRGB(255, 255, 0))
            else
                if cheese:FindFirstChildOfClass("Highlight") then
                    cheese:FindFirstChildOfClass("Highlight"):Destroy()
                end
            end
        end
    end
end

local function toggleRatESP(state)
    RatESP_Enabled = state
    for _, rat in pairs(Workspace:GetChildren()) do
        if rat.Name:lower():find("rat") and rat:FindFirstChild("HumanoidRootPart") then
            if state then
                highlight(rat.HumanoidRootPart, Color3.fromRGB(255, 0, 0))
            else
                if rat.HumanoidRootPart:FindFirstChildOfClass("Highlight") then
                    rat.HumanoidRootPart:FindFirstChildOfClass("Highlight"):Destroy()
                end
            end
        end
    end
end

--// Noclip
RunService.Stepped:Connect(function()
    if Noclip and LocalPlayer.Character then
        for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

--// Fly
local function setFly(enable)
    Flying = enable
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local bv = Instance.new("BodyVelocity", hrp)
    bv.MaxForce = Vector3.new(1e9, 1e9, 1e9)
    bv.Velocity = Vector3.zero

    local bg = Instance.new("BodyGyro", hrp)
    bg.MaxTorque = Vector3.new(1e9, 1e9, 1e9)
    bg.CFrame = hrp.CFrame

    local flyConn
    flyConn = RunService.RenderStepped:Connect(function()
        if not Flying then
            bv:Destroy()
            bg:Destroy()
            flyConn:Disconnect()
            return
        end

        local camCF = Workspace.CurrentCamera.CFrame
        local move = Vector3.zero
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += camCF.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= camCF.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= camCF.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += camCF.RightVector end
        bv.Velocity = move * 100
        bg.CFrame = camCF
    end)
end

--// Main Tab
Main:CreateButton({
    Name = "Auto Collect Cheese",
    Callback = function()
        for _, cheese in pairs(Workspace:GetDescendants()) do
            if cheese.Name:lower():find("cheese") and cheese:IsA("BasePart") then
                cheese.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame
                task.wait(0.1)
            end
        end
    end
})

Main:CreateToggle({
    Name = "ESP: Cheese",
    CurrentValue = false,
    Callback = function()
      toggleCheeseESP
})

Main:CreateToggle({
    Name = "ESP: Rat",
    CurrentValue = false,
    Callback = function()
      toggleRatESP
})

--// Teleports Tab
TeleportTab = Teleports

TeleportTab:CreateButton({
    Name = "Teleport: Safe Zone",
    Callback = function()
        local safe = Workspace:FindFirstChild("SafeZone") or Workspace:FindFirstChild("Safe")
        if safe and safe:IsA("BasePart") then
            LocalPlayer.Character:PivotTo(safe.CFrame + Vector3.new(0, 5, 0))
        end
    end
})

TeleportTab:CreateButton({
    Name = "Teleport: Exit Door",
    Callback = function()
        local door = Workspace:FindFirstChild("Exit") or Workspace:FindFirstChild("Door")
        if door and door:IsA("BasePart") then
            LocalPlayer.Character:PivotTo(door.CFrame + Vector3.new(0, 5, 0))
        end
    end
})

TeleportTab:CreateButton({
    Name = "Teleport: Start Point",
    Callback = function()
        LocalPlayer.Character:PivotTo(CFrame.new(0, 10, 0))
    end
})

--// Player Tab
Player:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 100},
    Increment = 1,
    CurrentValue = 16,
    Callback = function(val)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = val
        end
    end
})

Player:CreateSlider({
    Name = "JumpPower",
    Range = {50, 150},
    Increment = 1,
    CurrentValue = 50,
    Callback = function(val)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.JumpPower = val
        end
    end
})

Player:CreateToggle({
    Name = "Enable Noclip",
    CurrentValue = false,
    Callback = function(val)
        Noclip = val
    end
})

Player:CreateToggle({
    Name = "Enable Fly",
    CurrentValue = false,
    Callback = function(val)
        setFly(val)
    end
})

--// Settings Tab
Settings:CreateButton({
    Name = "Reset Character",
    Callback = function()
        LocalPlayer:LoadCharacter()
    end
})

Settings:CreateParagraph({
    Title = "Credits",
    Content = "Frenzy Hub | NebulaStrike\nGUI: Luna Interface Suite\nGame: Cheese Escape"
})
